<div id="notificationContainer" class="position-fixed" style="top: 70px; right: 20px; z-index: 1050; max-width: 350px;">
    <!-- Notifications will be dynamically added here -->
</div>

<style>
    .notification-toast {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        margin-bottom: 10px;
        overflow: hidden;
        animation: slideIn 0.3s ease-out;
        border-left: 4px solid #008080;
    }
    
    .notification-toast.income {
        border-left-color: #008080;
        background: linear-gradient(135deg, #f8fff9, white);
    }
    
    .notification-toast.expense {
        border-left-color: #dc3545;
        background: linear-gradient(135deg, #fff8f8, white);
    }
    
    .notification-toast.budget-warning {
        border-left-color: #FFD700;
        background: linear-gradient(135deg, #fffef0, white);
    }
    
    .notification-toast.budget-danger {
        border-left-color: #FF6B6B;
        background: linear-gradient(135deg, #fff5f5, white);
        animation: pulse 2s infinite;
    }
    
    .notification-toast.budget-critical {
        border-left-color: #DC143C;
        background: linear-gradient(135deg, #ffe0e0, white);
        animation: criticalPulse 1s infinite;
        border: 2px solid #DC143C;
    }
    
    .notification-toast.contact {
        border-left-color: #20C997;
        background: linear-gradient(135deg, #f0fff9, white);
    }
    
    @@keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @@keyframes pulse {
        0% { box-shadow: 0 4px 20px rgba(255, 107, 107, 0.3); }
        50% { box-shadow: 0 4px 30px rgba(255, 107, 107, 0.6); }
        100% { box-shadow: 0 4px 20px rgba(255, 107, 107, 0.3); }
    }
    
    @@keyframes criticalPulse {
        0% { box-shadow: 0 4px 20px rgba(220, 20, 60, 0.4); transform: scale(1); }
        25% { box-shadow: 0 4px 30px rgba(220, 20, 60, 0.8); transform: scale(1.02); }
        50% { box-shadow: 0 4px 40px rgba(220, 20, 60, 0.6); transform: scale(1.01); }
        75% { box-shadow: 0 4px 30px rgba(220, 20, 60, 0.8); transform: scale(1.02); }
        100% { box-shadow: 0 4px 20px rgba(220, 20, 60, 0.4); transform: scale(1); }
    }
    
    @@keyframes iconPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
    }
    
    .notification-header {
        background: #f8f9fa;
        padding: 12px 16px;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .notification-body {
        padding: 16px;
        color: #333;
        font-size: 14px;
        line-height: 1.4;
    }
    
    .notification-icon {
        width: 20px;
        height: 20px;
        margin-right: 8px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        color: white;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }
    
    .notification-icon.income { background: #008080; }
    .notification-icon.expense { background: #dc3545; }
    .notification-icon.budget-warning { background: #FFD700; color: #333; }
    .notification-icon.budget-danger { background: #FF6B6B; }
    .notification-icon.budget-critical { background: #DC143C; animation: iconPulse 1s infinite; }
    .notification-icon.contact { background: #20C997; }
    .notification-icon.custom { background: transparent; width: 24px; height: 24px; }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        if ('@@User.Identity.IsAuthenticated' === 'True') {
            var connection = new signalR.HubConnectionBuilder()
                .withUrl('/notificationHub')
                .configureLogging(signalR.LogLevel.Information)
                .build();

            connection.on('ReceiveNotification', function (message) {
                var notificationType = getNotificationType(message);
                var iconElement = getNotificationIconElement(message);
                
                var notificationHtml = '<div class="notification-toast ' + notificationType + '">' +
                    '<div class="notification-header">' +
                        '<div style="display: flex; align-items: center;">' +
                            iconElement +
                            '<strong style="font-size: 14px;">SmartExpense</strong>' +
                        '</div>' +
                        '<button type="button" onclick="this.closest(\'.notification-toast\').remove()" ' +
                                'style="background: none; border: none; font-size: 18px; cursor: pointer; color: #999;">Ã—</button>' +
                    '</div>' +
                    '<div class="notification-body">' +
                        message +
                    '</div>' +
                '</div>';
                
                var container = document.getElementById('notificationContainer');
                container.insertAdjacentHTML('beforeend', notificationHtml);
                
                // Auto-remove after 6 seconds
                setTimeout(function() {
                    var toast = container.lastElementChild;
                    if (toast) {
                        toast.style.animation = 'slideIn 0.3s ease-out reverse';
                        setTimeout(function() { toast.remove(); }, 300);
                    }
                }, 6000);
                
                // Limit to 5 notifications max
                var notifications = container.querySelectorAll('.notification-toast');
                if (notifications.length > 5) {
                    notifications[0].remove();
                }
            });

            function getNotificationType(message) {
                if (message.indexOf('ğŸ’°') !== -1) return 'income';
                if (message.indexOf('ğŸ’¸') !== -1) return 'expense';
                if (message.indexOf('ğŸš¨ğŸš¨') !== -1 || message.indexOf('CRITICAL') !== -1) return 'budget-critical';
                if (message.indexOf('ğŸš¨') !== -1 || message.indexOf('exceeded') !== -1) return 'budget-danger';
                if (message.indexOf('âš ï¸') !== -1 || message.indexOf('Warning') !== -1) return 'budget-warning';
                if (message.indexOf('ğŸ“§') !== -1) return 'contact';
                return '';
            }
            
            function getNotificationIcon(message) {
                if (message.indexOf('ğŸ’°') !== -1) return 'â†‘';
                if (message.indexOf('ğŸ’¸') !== -1) return 'â†“';
                if (message.indexOf('ğŸš¨ğŸš¨') !== -1 || message.indexOf('CRITICAL') !== -1) return 'ğŸš¨';
                if (message.indexOf('ğŸš¨') !== -1) return 'âš ';
                if (message.indexOf('âš ï¸') !== -1) return 'âš ';
                if (message.indexOf('ğŸ“§') !== -1) return '@@';
                if (message.indexOf('ğŸ“Š') !== -1) return 'ğŸ“Š';
                if (message.indexOf('ğŸ“·') !== -1) return 'ğŸ“·';
                
                // Check for custom emojis (you can add more here)
                const customEmojis = ['ğŸ˜ˆ', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ’€', 'ğŸ¤–', 'ğŸ‘¾', 'ğŸƒ', 'ğŸ‘»', 'ğŸ’©', 'ğŸ¤¡', 'ğŸ¦¹', 'ğŸ¦´', 'ğŸ¦µ', 'ğŸ¦¶', 'ğŸ¦·', 'ğŸ¦´'];
                for (let emoji of customEmojis) {
                    if (message.indexOf(emoji) !== -1) return emoji;
                }
                
                return 'ğŸ””';
            }
            
            function getNotificationIconElement(message) {
                const icon = getNotificationIcon(message);
                
                // Check if it's a custom emoji that should be displayed as text
                const customEmojis = ['ğŸ˜ˆ', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ’€', 'ğŸ¤–', 'ğŸ‘¾', 'ğŸƒ', 'ğŸ‘»', 'ğŸ’©', 'ğŸ¤¡', 'ğŸ¦¹', 'ğŸ¦´', 'ğŸ¦µ', 'ğŸ¦¶', 'ğŸ¦·', 'ğŸ¦´'];
                if (customEmojis.includes(icon)) {
                    return '<span class="notification-icon custom" style="font-size: 16px; line-height: 1;">' + icon + '</span>';
                }
                
                // Check for camera icon (image indicator)
                if (icon === 'ğŸ“·') {
                    return '<span class="notification-icon custom" style="font-size: 14px;">ğŸ“·</span>';
                }
                
                // Default icon
                return '<span class="notification-icon ' + getNotificationType(message) + '">' + icon + '</span>';
            }

            connection.start().catch(function(err) { console.error('SignalR connection error:', err); });
        }
    });
</script>
